<p id="notice"><%= notice %></p>

<script src="//maps.google.com/maps/api/js?key=AIzaSyBl4A9FU5D1xHc6wl5GEfY5KGXumWFHy6Q"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<div class="layout">

  <%= render 'shared/nav' %>

  <div class="main">

  	<div class="form-container--large">
  		
	    <h1 class="main-headline">
			Monitor empresarial
		</h1>

		<%= form_tag(index_manager_admin_path(), :method => "get", id: "search") do %>
		  <div class="buscador-empresarial">
		    <div class="ordenar-field">

		    	<strong>PUEDES FILTRAR POR: </strong>

		    	<strong class="hide">SECTOR: </strong>
				<%= select_tag :sector, options_for_select(Sector.all.map{|s|[s.name, s.id]},params[:sector]), {:include_blank => 'Sector'} %>

		    	<strong class="hide">NIVEL: </strong>
		  		<%= select_tag :level, options_for_select([['Regional', 'regional'], ['Municipal', 'municipal']], params[:level]), {:include_blank => 'Nivel'} %>
		    	<strong class="hide">UBICACIÃ“N: </strong>
		    	<%= select_tag :location, options_for_select(@municipios.map{|s|[s.name, s.id]},params[:location]), {:include_blank => 'Region'} %>

		    	<%= submit_tag "Buscar" %>    
		    </div>
		  </div>
		<% end %>

		<div id="map"></div>

	</div>

	<script type="text/javascript">

		handler = Gmaps.build('Google');

		handler.buildMap({
			internal: {id: 'map'},
			provider: {
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				styles: [	{"featureType":"all",		"stylers":[			{"saturation":0},			{"hue":"#e7ecf0"}		]	},	{"featureType":"road",		"stylers":[			{"saturation":-70}		]	},	{"featureType":"transit",		"stylers":[			{"visibility":"off"}		]	},	{"featureType":"poi",		"stylers":[			{"visibility":"off"}		]	},	{"featureType":"water",		"stylers":[			{"visibility":"simplified"},			{"saturation":-60}		]	}]
			} 
			
		}, function(){
		  markers = handler.addMarkers(<%=raw @hash.to_json %>);
		  handler.bounds.extendWith(markers);
		  handler.fitMapToBounds();
		  handler.getMap().setZoom(15);
		});
	</script>

  </div><!-- .main -->
</div><!-- .layout -->

<%= render "shared/footer" %>